<html>
  <head>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@c5c5dcf/dist/aframe-extras.min.js"></script>
    <script src="../src/instanced-mesh.js"></script>
    <script src="./framed-block.js"></script>
    <script>
      AFRAME.registerComponent('scale-on-hover', {

        init() {

          // On click, toggle size between 0.4 and 0.45
          this.el.addEventListener('click', () => {
            if (this.el.object3D.scale.x > 0.4) {
              this.el.object3D.scale.set(0.4, 0.4, 0.4)
            }
            else {
              this.el.object3D.scale.set(0.45, 0.45, 0.45)
            }            
            this.el.emit('object3DUpdated')
          });

          // On hover, reduce size to 0.45 unless already smaller than that.
          this.el.addEventListener('mouseenter', () => {
            if (this.el.object3D.scale.x > 0.4) {
              this.el.object3D.scale.set(0.45, 0.45, 0.45)
              this.el.emit('object3DUpdated')
            }
          });          
          
          // On mouseleave, reset size to 0.5 if not clicked - else leave as 0.4
          this.el.addEventListener('mouseleave', () => {
            if (this.el.object3D.scale.x > 0.4) {
              this.el.object3D.scale.set(0.5, 0.5, 0.5)
              this.el.emit('object3DUpdated')
            }            
          });
        }
      })
    </script>
    </script>
  </head>
  <body>
    <a-scene stats renderer="colorManagement:true">
      <a-entity cursor="rayOrigin: mouse; fuse: false" raycaster="objects: [scale-on-hover]">
      </a-entity>
      
      <a-mixin id="shape1" instanced-mesh-member="mesh:#mesh1; memberMesh: true" scale = "0.5 0.5 0.5"
               scale-on-hover>
      </a-mixin>

    <a-entity id="rig" movement-controls>
      <a-entity id="camera" camera position="0 1.6 0" look-controls>
      </a-entity>
    </a-entity>

    <!-- wall of blocks-->
    <a-text position = "-5 4 -6" color ="black"
       value="Raycasting example (using cursor).
              Hover mouse over a block and it should reduce in size slightly.
              Click to permanently reduce size."></a-text>
    <a-entity id="mesh1"
              framed-block="facecolor: yellow; framecolor: black"
              position = "0 0 0"
              instanced-mesh="capacity:15"></a-entity>
    <a-entity id ="block0" position = "-2 0 -6" mixin="shape1"></a-entity>
    <a-entity id ="block1" position = "-1 0 -6" mixin="shape1"></a-entity>
    <a-entity id ="block2" position = "0 0 -6" mixin="shape1"></a-entity>
    <a-entity id ="block3" position = "1 0 -6" mixin="shape1"></a-entity>
    <a-entity id ="block4" position = "2 0 -6" mixin="shape1"></a-entity>

    <a-entity id ="block5" position = "-2 1 -6" mixin="shape1"></a-entity>
    <a-entity id ="block6" position = "-1 1 -6" mixin="shape1"></a-entity>
    <a-entity id ="block7" position = "0 1 -6" mixin="shape1"></a-entity>
    <a-entity id ="block8" position = "1 1 -6" mixin="shape1"></a-entity>
    <a-entity id ="block9" position = "2 1 -6" mixin="shape1"></a-entity>

    <a-entity id ="block10" position = "-2 2 -6" mixin="shape1"></a-entity>
    <a-entity id ="block11" position = "-1 2 -6" mixin="shape1"></a-entity>
    <a-entity id ="block12" position = "0 2 -6" mixin="shape1"></a-entity>
    <a-entity id ="block13" position = "1 2 -6" mixin="shape1"></a-entity>
    <a-entity id ="block14" position = "2 2 -6" mixin="shape1"></a-entity>

</a-scene>

</body>
